<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SnapIn</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="node_modules/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
    <style type='text/css'>
        .embeddedServiceHelpButton .helpButton .uiButton { background-color: #005290; font-family: "Salesforce Sans", sans-serif; }
        .embeddedServiceHelpButton .helpButton .uiButton:focus { outline: 1px solid #005290; }
        @font-face {
        font-family: 'Salesforce Sans';
        src: url('https://www.sfdcstatic.com/system/shared/common/assets/fonts/SalesforceSans/SalesforceSans-Regular.woff') format('woff'),
        url('https://www.sfdcstatic.com/system/shared/common/assets/fonts/SalesforceSans/SalesforceSans-Regular.ttf') format('truetype');
        }
    </style>
    <script src="main.js"></script>
</head>
<body>
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="#">
            <img src="assets/DellTech_Logo_Prm_Blue.jpg" class="d-inline-block align-top" alt="">
        </a>
    </nav>
    <div class="container">
        <div class="resume-chat-msg hide">
            <div class="row">
                <div class="col-lg-12">
                    <div class="jumbotron">
                        <h1 class="display-4">Welcome Back</h1>
                    </div>
                </div>
            </div>
        </div>
        <div class="new-chat">
            <div class="row">
                <div class="col-lg-2"></div>
                <div class="col-lg-8">
                    <form>
                        <div class="form-group">
                            <label for="serviceTag">Service Tag</label>
                            <input type="text" class="form-control"  id="serviceTag" aria-describedby="serviceTag" placeholder="Enter Service Tag" onblur="showIssue()">
                            <p>Based on asset warranty contact channel will be displayed</p>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="language" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Select Your Language
                            </button>
                            <div id="languageDropdown" class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                <a class="dropdown-item" href="#" lang="ja">Japanese - ja</a>
                                <a class="dropdown-item" href="#" lang="en-us">English en-us</a>
                            </div>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Select Issue Type
                            </button>
                            <div id="issueDropdown" class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                <a class="dropdown-item" href="#">Slow Performance</a>
                                <a class="dropdown-item" href="#">Keyboard not working</a>
                                <a class="dropdown-item" href="#">Touch pad not working</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div id="contact-row" class="row">
                <div class="col-lg-2"></div>
                <div class="col-lg-8">
                    <h3 class="non-live-agent">Contact Options</h3>
                    <h3 class="live-agent-heading">Contact Options for Live Agent</h3>
                    <div class="call-us">
                        <h5>Call Us</h5>
                        <p class="phone-no">1-855-305-9057</p>
                        <p>24/7</p>
                        <p>Please Note: You will be asked to enter your Express Service Code: <strong>34285956052</strong></p>
                    </div>
                    <div class="chat-with-us">
                        <h5>Chat with us</h5>
                        <p>Start a chat session with one of our technical support experts.</p>
                        <button type="button" id="chatButton" class="btn btn-primary" onclick="initChat()">Start Chat</button>
                        <div class="live-agent-button">
                                <script type='text/javascript' src='https://c.la4-c1cs-phx.salesforceliveagent.com/content/g/js/43.0/deployment.js'></script>
                                <script type='text/javascript'>
                                liveagent.init('https://d.la4-c1cs-phx.salesforceliveagent.com/chat', '5723B0000004Crz', '00Dm0000000DQXs');
                                </script>
                            <a id="liveagent_button_online_5733B0000004D90" class="btn btn-primary" href="javascript://Chat" onclick="liveagent.startChat('5733B0000004D90')">Start Chat</a><div id="liveagent_button_offline_5733B0000004D90" style="display: none;"><!-- Offline Chat Content --></div><script type="text/javascript">
                                if (!window._laq) { window._laq = []; }
                                window._laq.push(function(){liveagent.showWhenOnline('5733B0000004D90', document.getElementById('liveagent_button_online_5733B0000004D90'));
                                liveagent.showWhenOffline('5733B0000004D90', document.getElementById('liveagent_button_offline_5733B0000004D90'));
                                });</script> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script src="https://unpkg.com/popper.js/dist/umd/popper.min.js"></script>
<script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
<script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js'></script>
<script type='text/javascript'>
    $('.dropdown').hide();
    $('#contact-row').hide();
    $('#issueDropdown > a').click(function() {
        var val = $(this).text();
        if( val != 'Select Issue Type' ) {
            $('#dropdownMenuButton').text(val);
            $('#contact-row').show();
            if( document.getElementById('serviceTag').value.toLowerCase() === 'dtb4pc2' ) {
                $('.call-us').hide();
                $('.live-agent-button').hide();
                $('#chatButton').show();
                $('.non-live-agent').show();
                $('.live-agent-heading').hide();
            } else if( document.getElementById('serviceTag').value.toLowerCase() === '10cy091' ) {
                $('.call-us').show();
                $('.live-agent-button').show();
                $('#chatButton').hide();
                $('.non-live-agent').hide();
                $('.live-agent-heading').show();
            } else {
                $('.call-us').show();
                $('.live-agent-button').hide();
                $('#chatButton').show();
                $('.non-live-agent').show();
                $('.live-agent-heading').hide();
            }
        }
    });

    $('#languageDropdown > a').click(function() {
        var attrVal = $(this).attr('lang');
        var eleVal = $(this).text();
        $('#language').attr('selLang', attrVal);
        $('#language').text(eleVal);
    });

    (function() {
        debugger;
        if( window.location.href.split("?").length > 1 ) {
            var urlParameters = window.location.href.split("?")[1];
            var serviceTag = urlParameters.split("&")[0].split("=")[1].toLowerCase();
            var srNumber = urlParameters.split("&")[1].split("=")[1].toLowerCase();
            var FirstName = urlParameters.split("&")[2].split("=")[1].toLowerCase();
            var lastName = urlParameters.split("&")[3].split("=")[1].toLowerCase();
            if( serviceTag != '' ) {
                resumeChat("573m00000004DCd", "572m00000004Cl7", serviceTag, srNumber, FirstName, lastName, 'snapIn');
                // resumeChat("573m00000004DCE", "572m00000004Cl2", serviceTag, srNumber, FirstName, lastName, 'snapIn');
                eleExist('#helpButtonSpan > .message', chatClick);
            }
            $('.resume-chat-msg').removeClass('hide');
            $('.new-chat').addClass('hide');
        } else {
            $('.resume-chat-msg').addClass('hide');
            $('.new-chat').removeClass('hide');
        }
    })();

    function showIssue() {
        if( $('#serviceTag').val().length != 0 ) {
            $('.dropdown').show();
        } else {
            $('.dropdown').hide();
            $('#dropdownMenuButton').text('Select Issue Type');
            $('#contact-row').hide();
        }
    }

    function initChat(serviceTag) {
        var buttonId, deploymentId;
        if( serviceTag === "" || serviceTag === undefined  ) {
            var serviceTagVal = document.getElementById('serviceTag').value.toLowerCase();
            var issueVal = $('#dropdownMenuButton').text();
        } else {
            var serviceTagVal = serviceTag;
        }
        if( serviceTagVal === 'dtb4pc2' ) {
            buttonId = '573m00000004DC9';
            deploymentId = '572m00000004Ckx';
        } else if( serviceTagVal === '261kz72' || serviceTagVal === '29vzs71' ) {
            buttonId = '573m00000004DCE';
            deploymentId = '572m00000004Cl2'; 
        }
        serviceTagVal = serviceTagVal.toUpperCase();
        var selectLang = $('#language').attr('sellang')
        var initESW = function(gslbBaseURL, deploymentId, buttonId, serviceTagVal, issueVal, selectLang) {
            embedded_svc.settings.displayHelpButton = true; //Or false
            // if( selectLang === 'ja' ) {
            //     embedded_svc.settings.language = 'ja';
            // } else {
            //     embedded_svc.settings.language = '';
            // }
            embedded_svc.settings.language = "ja";

            embedded_svc.settings.enabledFeatures = ['LiveAgent'];
            embedded_svc.settings.entryFeature = 'LiveAgent';
            embedded_svc.settings.extraPrechatFormDetails = [
                                                        {"label":"First Name", "transcriptFields":["FirstName__c"]},
                                                        {"label":"Last Name", "transcriptFields":["LastName__c"]},
                                                        {"label":"Primary Phone Number", "transcriptFields":["ContactNumber__c"]},
                                                        {"label":"Email Address", "transcriptFields":["Email__c"]},
                                                        {"label":"Subject", "value":issueVal, "transcriptFields":["Issue__c"]},
                                                        {"label":"Service Tag", "value":serviceTagVal, "transcriptFields":["Service_Tag__c"]},
                                                        {"label":"Issue Description", "transcriptFields":["Description__c"]},
                                                        {"label":"AccountNumber", "transcriptFields":["CustomerNumber__c"]},
                                                        {"label":"Account BUID", "transcriptFields":["CustomerBUID__c"]},
                                                        ];  
            embedded_svc.settings.extraPrechatInfo = [{
                            "entityFieldMaps": [{
                                "doCreate":false,
                                "doFind":true,
                                "fieldName":"LastName",
                                "isExactMatch":true,
                                "label":"Last Name"
                            }, {
                                "doCreate":false,
                                "doFind":true,
                                "fieldName":"FirstName",
                                "isExactMatch":true,
                                "label":"First Name"
                            }, {
                                "doCreate":false,
                                "doFind":true,
                                "fieldName":"Email",
                                "isExactMatch":true,
                                "label":"Email"
                            }, {
                                "doCreate":false,
                                "doFind":true,
                                "fieldName":"Primary_Phone__c",
                                "isExactMatch":true,
                                "label":"Primary Phone Number"
                            }],
                            "entityName":"Contact"
                        },{
                            "entityFieldMaps": [{
                            "doCreate": false,
                            "doFind": true,
                            "fieldName": "Name",
                            "isExactMatch": true,
                            "label": "Service Tag"
                            }],
                            "entityName": "Asset",
                            "saveToTranscript": "Asset__c"
                        },{
                            "entityFieldMaps": [{
                                "doCreate":false,
                                "doFind":true,
                                "fieldName":"Issue_Description__c",
                                "isExactMatch":true,
                                "label":"Issue Description"
                            }
                            ],
                            "entityName":"Case"
                        }
                    ];                                          
            
            embedded_svc.init('https://dellservices--DEV3.cs20.my.salesforce.com', 'https://dev3-dev2-dellservices--dev2.cs20.force.com/LA', gslbBaseURL, '00Dm0000000DQXs', 'Test_Snap_In', { baseLiveAgentContentURL: 'https://c.la4-c1cs-phx.salesforceliveagent.com/content', deploymentId: '572m00000004Ckx', buttonId: '573m00000004DC9', baseLiveAgentURL: 'https://d.la4-c1cs-phx.salesforceliveagent.com/chat', eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04Im0000000001iEAA_16369f295e6', isOfflineSupportEnabled: false}); };if (!window.embedded_svc) { var s = document.createElement('script'); s.setAttribute('src', 'https://dellservices--DEV3.cs20.my.salesforce.com/embeddedservice/5.0/esw.min.js'); s.onload = function() { initESW(null, deploymentId, buttonId, serviceTagVal, issueVal, selectLang); }; document.body.appendChild(s); eleExist('#helpButtonSpan > .message', chatClick); eleExist('.Issue_Description__c', changeMaxLengthInput);} else { initESW('https://service.force.com', deploymentId, buttonId, serviceTagVal, issueVal, selectLang); eleExist('#helpButtonSpan > .message', chatClick); eleExist('.Issue_Description__c', changeMaxLengthInput);}
    }

    function eleExist(eleSelector, callbackFunc) {
        var findingEle = setInterval(function() {
            if( $(eleSelector).length > 0 ) {
                callbackFunc(eleSelector, findingEle);
            }
        }, 1000);
    }

    function chatClick(eleSelector, findingEle) {
        if( $(eleSelector).text() === 'Chat with an Expert' ) {
            $('#helpButtonSpan > .message').click();
            clearInterval(findingEle);
        }
    }

    function changeMaxLengthInput(eleSelector, findingEle) {
        $(eleSelector).attr('maxlength', 500);
        clearInterval(findingEle);
    }

    function resumeChat(buttonId, deploymentId, serviceTag, srNumber, FirstName, lastName) {
        var initESW = function(gslbBaseURL) {
            embedded_svc.settings.displayHelpButton = true; //Or false
            embedded_svc.settings.language = ''; //For example, enter 'en' or 'en-US'
            // embedded_svc.settings.initialInteractionState = "WAITING";
            embedded_svc.settings.enabledFeatures = ['LiveAgent'];
            embedded_svc.settings.entryFeature = 'LiveAgent';
            
            embedded_svc.settings.extraPrechatFormDetails = [{
                "label":"Delta Sr",
                "value": srNumber,
                "transcriptFields":[ "Delta_SR__c" ]
            },
            { "label":"First Name", "name":"FirstName", "value":FirstName, "displayToAgent":true },
            { "label":"Last Name", "value":lastName, "displayToAgent":true }];
             
            // embedded_svc.settings.extraPrechatInfo = [{
            //         "entityFieldMaps": [{
            //             "doCreate":false,
            //             "doFind":false,
            //             "fieldName":"Delta_SR__c",
            //             "isExactMatch":true,
            //             "label":"Delta Sr"
            //         }
            //         ],
            //         "entityName":"LiveChatTranscript",
            //         "saveToTranscript": "Delta_SR__c"
            //     }];

            // embedded_svc.settings.extraPrechatFormDetails = [{ "label":"First Name", "name":"FirstName", "value":FirstName, "displayToAgent":true }, { "label":"Last Name", "value":lastName, "displayToAgent":true } ];
            embedded_svc.init('https://dellservices--DEV3.cs20.my.salesforce.com', 'https://dev3-dev2-dellservices--dev2.cs20.force.com/LASI1', gslbBaseURL, '00Dm0000000DQXs', 'Test_snapin_resumechat', { baseLiveAgentContentURL: 'https://c.la4-c1cs-phx.salesforceliveagent.com/content', deploymentId: deploymentId, buttonId: buttonId, baseLiveAgentURL: 'https://d.la4-c1cs-phx.salesforceliveagent.com/chat', eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04Im0000000001xEAA_1638222454e', isOfflineSupportEnabled: false}); };if (!window.embedded_svc) { var s = document.createElement('script'); s.setAttribute('src', 'https://dellservices--DEV3.cs20.my.salesforce.com/embeddedservice/5.0/esw.min.js'); s.onload = function() { initESW(null, srNumber); }; document.body.appendChild(s); } else { initESW('https://service.force.com', srNumber); }
    }
</script>
</html>