(function(w){var o="embeddedServiceHelpButton";var A=[".salesforce.com",".force.com",".sfdc.net"];var an="esw_storage_iframe";var ad="5.0";var L=100;var B="__snapinsLoginCallback";var v="__snapinsLogoutCallback";var ai="snapins_invite";var e="ESW_OAUTH_TOKEN";var G="ESW_BODY_SCROLL_POSITION";var J="ESW_IS_MINIMIZED";var Y="ESW_MINIMIZED_TEXT";function l(){var ao=false;var ap;this.settings={appendHelpButton:true,displayHelpButton:true,isExternalPage:true,devMode:false,targetElement:document.body,elementForOnlineDisplay:undefined,elementForOfflineDisplay:undefined,defaultMinimizedText:"",disabledMinimizedText:"",loadingText:"Loading",enabledFeatures:[],entryFeature:"FieldService",storageDomain:document.domain,language:undefined,linkAction:{feature:undefined,name:undefined,valid:false},linkActionParameters:{},useCustomAuthentication:false};this.auth={};this.validLinkActions={};Object.defineProperty(this.auth,"oauthToken",{get:function(){return ap;},set:function(aq){if(this.validateHeaderValue(aq)){ap=aq;if(aq){this.setSessionData(e,aq);this.checkAuthentication();}else{this.deleteSessionData(e);}}else{this.error('"'+aq+'" is not a valid OAuth token.');}}.bind(this)});this.featureScripts={};this.eventHandlers={};this.messageHandlers={};this.storageKeys=[G,J,Y,e];this.defaultSettings={};this.eswFrame=undefined;this.availableFeatures=["script","session"];this.outboundMessagesAwaitingIframeLoad=[];this.pendingMessages={};this.iframeScriptsToLoad=[];this.domInitInProgress=false;this.componentInitInProgress=false;this.hasSessionDataLoaded=false;this.isIframeReady=false;this.isAuthenticationRequired=false;this.loginPendingSerializedData=undefined;Object.defineProperty(this,"isButtonDisabled",{get:function(){return ao;},set:function(aq){ao=aq;this.onButtonStatusChange();}.bind(this),configurable:true});this.setupMessageListener();this.getLinkActionData();}l.prototype.outputToConsole=function ak(ap,ao){if(this.settings.devMode&&console&&console[ap]){console[ap]("[Snap-ins] "+(Array.isArray(ao)?ao.join(", "):ao));}};l.prototype.log=function r(){this.outputToConsole("log",[].slice.apply(arguments));};l.prototype.error=function K(ao){if(ao){this.outputToConsole("error",ao);}else{this.outputToConsole("error","esw responed with an unspecified error.");}this.fireEvent("error");};l.prototype.warning=function p(ao){if(ao){this.outputToConsole("warn","Warning: "+ao);}else{this.outputToConsole("warn","esw sent an anonymous warning.");}};l.prototype.deprecated=function y(ao){this.warning(ao+" is deprecated in version "+Number(ad).toFixed(1)+" and will be removed in version "+(Number(ad)+1).toFixed(1));};l.prototype.getCookie=function k(aq){var ar=document.cookie;var ap;var ao;if(ar){ap=ar.indexOf(aq+"=");if(ap!==-1){ap+=(aq+"=").length;ao=ar.indexOf(";",ap);if(ao===-1){ao=ar.length;}return ar.substring(ap,ao);}}return undefined;};l.prototype.setCookie=function x(aq,at,ao){var ar=aq+"="+at+";";var ap;if(ao){ap=new Date();ap.setFullYear(ap.getFullYear()+10);ar+="expires="+ap.toUTCString()+";";}ar+="path=/;";document.cookie=ar;};l.prototype.mergeSettings=function F(ao){Object.keys(ao).forEach(function(ap){if(this.settings[ap]===undefined){this.settings[ap]=ao[ap];}}.bind(this));};l.prototype.loadFeatureScript=function O(ao,aq){var ap=ao.toLowerCase();this.loadScriptFromDirectory("client",ap+".esw",function(){this.featureScripts[ao](this);this.availableFeatures.push(ap);this.fireEvent("featureLoaded",undefined,ao);if(aq){aq();}this.processPendingMessages(ap);}.bind(this));};l.prototype.fireEvent=function ac(ar,ao){var ap=this.eventHandlers[ar.toLowerCase()];var aq=[].slice.apply(arguments).slice(2);var at=[];if(ap){ap.forEach(function(au){at.push(au.apply(undefined,aq));});}if(ao){return ao(at);}return true;};l.prototype.isValidEntityId=function X(ao){return typeof ao==="string"&&(ao.length===18||ao.length===15);};l.prototype.getKeyPrefix=function h(ao){if(this.isValidEntityId(ao)){return ao.substr(0,3);}return undefined;};l.prototype.isOrganizationId=function f(ao){return this.getKeyPrefix(ao)==="00D";};l.prototype.getESWFrame=function S(){var ao=document.getElementById(an);if(!this.eswFrame&&ao){this.eswFrame=ao.contentWindow;}return this.eswFrame;};l.prototype.isFrameStorageEnabled=function aa(){this.deprecated("isFrameStorageEnabled");return true;};l.prototype.processPendingMessages=function u(ao){if(this.pendingMessages[ao]){this.pendingMessages[ao].forEach(function(ap){this.handleMessage(ap.payload);}.bind(this));this.pendingMessages[ao]=undefined;}};l.prototype.loadCSS=function C(){var ao=document.createElement("link");var ap=this.settings.gslbBaseURL?this.settings.gslbBaseURL:this.settings.baseCoreURL;ao.href=ap+"/embeddedservice/"+this.settings.releaseVersion+"/esw"+(this.settings.devMode?"":".min")+".css";ao.type="text/css";ao.rel="stylesheet";document.getElementsByTagName("head")[0].appendChild(ao);};l.prototype.appendHelpButton=function U(ao){var ap=document.createElement("div");ap.className=o;ap.innerHTML='<div class="helpButton">'+'<button class="helpButtonEnabled uiButton" href="javascript:void(0)">'+'<span class="embeddedServiceIcon" aria-hidden="true" data-icon="&#59648;"></span>'+'<div class="helpButtonLabel" id="helpButtonSpan" aria-live="polite" aria-atomic="true">'+'<span class="message">'+this.settings.defaultMinimizedText+"</span>"+"</div>"+"</button>"+"</div>";if(!ao){ap.style.display="none";}this.settings.targetElement.appendChild(ap);if("ontouchstart" in document.documentElement){[].slice.apply(document.querySelectorAll(".embeddedServiceHelpButton .uiButton")).forEach(function(aq){aq.classList.add("no-hover");});}this.onButtonStatusChange();};l.prototype.appendIFrame=function Z(){var ao=document.createElement("iframe");ao.id=an;ao.src=this.settings.iframeURL;ao.style.display="none";ao.onload=function(){var ap=this.getESWFrame();this.isIframeReady=true;this.outboundMessagesAwaitingIframeLoad.forEach(function(aq){ap.postMessage(aq,this.settings.iframeURL);}.bind(this));this.outboundMessagesAwaitingIframeLoad=[];this.iframeScriptsToLoad.forEach(function(aq){this.loadStorageScript(aq);}.bind(this));this.iframeScriptsToLoad=[];}.bind(this);this.settings.targetElement.appendChild(ao);window.addEventListener("beforeunload",function(){if("ActiveXObject" in window){ao.src="about:blank";}},false);};l.prototype.createLightningComponent=function V(ap){var ao={};if(document.getElementById(ai)&&embedded_svc.inviteAPI){embedded_svc.inviteAPI.inviteButton.setOnlineState(false);}this.hideHelpButton();this.fireEvent("beforeCreate");Object.keys(this.settings).forEach(function(aq){ao[aq]=this.settings[aq];}.bind(this));Object.keys(this.defaultSettings).forEach(function(aq){if(ao[aq]===undefined){ao[aq]=this.defaultSettings[aq];}}.bind(this));$Lightning.createComponent("embeddedService:sidebar",{configurationData:ao,serializedSessionData:ap},this.settings.targetElement,function(){this.componentInitInProgress=false;this.setHelpButtonText(ao.defaultMinimizedText);this.fireEvent("ready");}.bind(this));};l.prototype.loadLightningApp=function H(ap){var ao;var aq;if(this.settings.isExternalPage&&typeof this.settings.communityEndpointURL!=="string"){throw new Error("communityEndpointURL String property not set");}ao=document.getElementsByClassName("helpButton")[0];if(ao){aq=ao.getBoundingClientRect().width;if(aq>0){ao.style.width=aq+"px";}}this.setHelpButtonText(this.settings.loadingText,false);$Lightning.use("embeddedService:sidebarApp",function(){this.createLightningComponent(ap);}.bind(this),this.settings.communityEndpointURL,this.auth.oauthToken,this.settings.language&&this.settings.language.trim()!==""?{guestUserLang:this.settings.language}:undefined);};l.prototype.initLightningOut=function W(ap){var ao;if(this.hasSessionDataLoaded){if(!window.$Lightning||!this.settings.isExternalPage){ao=document.createElement("script");ao.type="text/javascript";ao.onload=function(){this.loadLightningApp(ap);}.bind(this);ao.src=this.settings.baseCoreURL+"/lightning/lightning.out.js";document.getElementsByTagName("head")[0].appendChild(ao);}else{this.loadLightningApp(ap);}}};l.prototype.setHelpButtonText=function M(ar,at){var ao=at===undefined?true:at;var aq=document.getElementById("helpButtonSpan");var ap;if(aq){ap=aq.querySelector(".message");ap.innerHTML=ar;aq.previousSibling.style.display=ao?"inline-block":"none";}};l.prototype.prepareDOM=function ah(){if(this.domInitInProgress){return;}this.domInitInProgress=true;this.appendIFrame();};l.prototype.addSessionHandlers=function T(){this.addMessageHandler("session.onLoad",function(){this.postMessage("session.get",this.storageKeys);}.bind(this));this.addMessageHandler("session.sessionData",function(ao){this.resumeInitWithSessionData(ao);}.bind(this));this.addMessageHandler("session.deletedSessionData",function(ao){if(ao.indexOf("CHASITOR_SERIALIZED_KEY")>-1){this.loginPendingSerializedData=undefined;}}.bind(this));};l.prototype.addMetaTag=function(ao,aq){var ap=document.createElement("meta");ap.name=ao;ap.content=aq;document.head.appendChild(ap);};l.prototype.init=function aj(aq,at,ap,ao,au,ar){this.settings.baseCoreURL=aq;this.settings.communityEndpointURL=at;this.settings.gslbBaseURL=ap?ap:aq;this.settings.orgId=ao;this.settings.releaseVersion=ad;this.settings.eswConfigDevName=au;this.mergeSettings(ar||{});if(typeof this.settings.baseCoreURL!=="string"){throw new Error("Base core URL value must be a string.");}if(!this.isOrganizationId(this.settings.orgId)){throw new Error("Invalid OrganizationId Parameter Value: "+this.settings.orgId);}if(this.fireEvent("validateInit",function(av){return av.indexOf(false)!==-1;},this.settings)){return;}if(this.settings.appendHelpButton){this.loadCSS();}if(!this.settings.targetElement){throw new Error("No targetElement specified");}this.settings.iframeURL=this.settings.gslbBaseURL+"/embeddedservice/"+this.settings.releaseVersion+(this.settings.devMode?"/eswDev.html":"/esw.html")+"?parent="+document.location.href;this.addSessionHandlers();this.loadFeatures();this.fireEvent("afterInit",undefined,this.settings);if(document.readyState==="complete"){setTimeout(this.prepareDOM.bind(this),1);}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",this.prepareDOM.bind(this),false);window.addEventListener("load",this.prepareDOM.bind(this),false);}else{if(window.attachEvent){window.attachEvent("onload",this.prepareDOM.bind(this));}else{this.log("No available event model. Exiting.");}}}};l.prototype.onHelpButtonClick=function c(){if(!this.componentInitInProgress&&!document.getElementsByClassName("embeddedServiceSidebar").length){this.componentInitInProgress=true;try{this.checkAuthentication();}catch(ao){this.componentInitInProgress=false;throw ao;}}};l.prototype.resumeInitWithSessionData=function ag(aq){var ap=this.fireEvent("sessionDataRetrieved",function(at){return at.indexOf(true)!==-1;},aq);var ao=false;var ar=false;if(this.settings.linkAction.valid){ao=true;}else{if(ap){this.log("Existing session found. Continuing with data: "+aq);ao=true;ar=true;}else{if(this.componentInitInProgress){ao=true;}}}this.hasSessionDataLoaded=true;if(aq[e]){this.auth.oauthToken=aq[e];}this.loginPendingSerializedData=ar?aq:undefined;if(ao){this.componentInitInProgress=true;this.checkAuthentication();}if(this.settings.appendHelpButton){this.appendHelpButton(this.settings.displayHelpButton&&!ap);}};l.prototype.checkAuthentication=function a(){if(this.isAuthenticationRequired){if(this.auth.oauthToken){if(this.loginButtonPressed||this.componentInitInProgress){this.initLightningOut(this.loginPendingSerializedData);}}else{this.fireEvent("requireauth");}}else{if(this.loginButtonPressed||this.componentInitInProgress){this.initLightningOut(this.loginPendingSerializedData);}}};l.prototype.postMessage=function n(ar,ap){var ao={domain:this.settings.storageDomain,data:ap,method:ar};var aq=this.getESWFrame();if(aq){aq.postMessage(ao,this.settings.iframeURL);}else{this.outboundMessagesAwaitingIframeLoad.push(ao);}};l.prototype.setSessionData=function P(aq,ao){var ap;if(typeof aq==="object"){ap=aq;}else{ap={};ap[aq]=ao;}this.postMessage("session.set",ap);};l.prototype.deleteSessionData=function ab(ao){var ap;if(Array.isArray(ao)){ap=ao;}else{ap=[ao];}this.postMessage("session.delete",ap);};l.prototype.defineFeature=function s(ao,ap){this.featureScripts[ao]=ap;};l.prototype.registerStorageKeys=function am(ao){if(typeof ao==="string"){this.storageKeys.push(name);}else{ao.forEach(function(ap){this.storageKeys.push(ap);}.bind(this));}};l.prototype.addMessageHandler=function z(ao,ap){this.messageHandlers[ao]=ap;};l.prototype.loadStorageScript=function m(ao){if(this.isIframeReady){this.postMessage("script.load",ao);}else{this.iframeScriptsToLoad.push(ao);}};l.prototype.loadScriptFromDirectory=function ae(ao,aq,au){var ar=aq.toLowerCase();var ap=document.createElement("script");var at=this.settings.gslbBaseURL;ap.type="text/javascript";ap.src=[at,"embeddedservice",this.settings.releaseVersion,ao,ar+(this.settings.devMode?"":".min")+".js"].join("/");if(au){ap.onload=au;}document.body.appendChild(ap);};l.prototype.loadFeatures=function i(){this.settings.enabledFeatures.forEach(function(ao){if(this.availableFeatures.indexOf(ao.toLowerCase())===-1){this.loadFeatureScript(ao);}}.bind(this));};l.prototype.addEventHandler=function I(ap,ao){var aq=ap.toLowerCase();if(!this.eventHandlers[aq]){this.eventHandlers[aq]=[];}this.eventHandlers[aq].push(ao);};l.prototype.setupMessageListener=function Q(){window.addEventListener("message",function(ar){var au=ar.data;var ao=ar.origin.split(":")[1].replace("//","");var aq;var at;var ap;if(au&&au.method&&embedded_svc.isMessageFromSalesforceDomain(ao)){if(au.method==="session.onLoad"&&this.settings.iframeURL.indexOf(ao)===-1){at=this.settings.iframeURL.split("/")[2];ap=ar.origin.split("/")[2];this.settings.iframeURL=this.settings.iframeURL.replace(at,ap);}aq=au.method.split(".")[0].toLowerCase();if(this.availableFeatures.indexOf(aq)===-1){if(!this.pendingMessages[aq]){this.pendingMessages[aq]=[];}this.pendingMessages[aq].push({direction:"incoming",payload:au});}else{this.handleMessage(au);}}}.bind(this),false);};l.prototype.handleMessage=function b(ao){if(this.messageHandlers[ao.method]){this.messageHandlers[ao.method](ao.data);}else{this.log("Unregistered method "+ao.method+" received.");}};l.prototype.isMessageFromSalesforceDomain=function g(ap){var ao=function(ar,aq){return ar.indexOf(aq,ar.length-aq.length)!==-1;};return A.some(function(aq){return ao(ap,aq);});};l.prototype.addDefaultSetting=function af(ap,ao){this.defaultSettings[ap]=ao;};l.prototype.onButtonStatusChange=function R(){var ao=document.querySelector(".embeddedServiceHelpButton button");var ap;if(ao){ap=ao.querySelector(".message");if(ap){if(this.isButtonDisabled){ao.onclick=function(){};ao.classList.remove("helpButtonEnabled");ao.classList.add("helpButtonDisabled");ap.innerHTML=this.settings.disabledMinimizedText;}else{ao.onclick=this.onHelpButtonClick.bind(this);ao.classList.remove("helpButtonDisabled");ao.classList.add("helpButtonEnabled");ap.innerHTML=this.settings.defaultMinimizedText;}}}};l.prototype.hideHelpButton=function al(){var ao=document.querySelector("."+o);if(ao){ao.style.display="none";}};l.prototype.showHelpButton=function j(){var ao=document.querySelector("."+o);if(ao){ao.style.display="";}};l.prototype.setDefaultButtonText=function E(ap,ao,aq){if(this.settings.entryFeature===ap){this.settings.defaultMinimizedText=this.settings.defaultMinimizedText||ao;this.settings.disabledMinimizedText=this.settings.disabledMinimizedText||aq;}};l.prototype.registerLinkAction=function d(ap,ao){var aq=this.settings.linkAction;if(!this.validLinkActions[ap]){this.validLinkActions[ap]=[];}if(this.validLinkActions[ap].indexOf(ao)===-1){this.validLinkActions[ap].push(ao);}if(aq.feature&&aq.name&&aq.feature.toLowerCase()===ap.toLowerCase()&&aq.name.toLowerCase()===ao.toLowerCase()){aq.valid=true;aq.feature=ap;this.settings.entryFeature=ap;}};l.prototype.setLinkAction=function N(ap,ar,aq){var ao=Object.keys(this.validLinkActions).filter(function(at){return at.toLowerCase()===ap.toLowerCase();})[0];if(ao){this.settings.linkAction.feature=ao;this.settings.linkAction.name=this.validLinkActions[ao].filter(function(at){return at.toLowerCase()===ar.toLowerCase();})[0];this.settings.linkAction.valid=this.settings.linkAction.name!==undefined;this.settings.linkActionParameters=aq;}else{this.settings.linkAction.valid=false;}};l.prototype.getLinkActionData=function t(){window.location.search.replace(/([a-zA-Z0-9._]+)=([^&\s]+)/g,function(ap,aq,at){var ar=aq.toLowerCase();var au;var ao;if(ar.indexOf("snapins.")===0){ao=ar.replace("snapins.","");if(ao==="action"){au=at.split(".");if(au.length===2){this.settings.linkAction.feature=au[0];this.settings.linkAction.name=au[1];}}else{this.settings.linkActionParameters[ao.toLowerCase()]=at;}}}.bind(this));};l.prototype.requireAuthentication=function q(){var ao=document.createElement("script");var aq=document.createElement("style");var ap=document.querySelector(this.settings.loginTargetQuerySelector);this.isAuthenticationRequired=true;if(window.location.protocol!=="https:"&&!this.settings.devMode){this.settings.displayHelpButton=false;throw new Error("Snap-in authentication requires HTTPS.");}if(!this.settings.useCustomAuthentication){if(!this.settings.loginClientId||!this.settings.loginRedirectURL||!this.settings.loginTargetQuerySelector){throw new Error("Authentication in Snap-ins requires these valid settings params: loginClientId, loginRedirectURL, loginTargetQuerySelector.");}if(ap){this.loginButtonPressed=false;ap.addEventListener("click",function(){this.loginButtonPressed=true;}.bind(this));}else{throw new Error("loginTargetQuerySelector is not a valid DOM element.");}this.addMetaTag("salesforce-community",this.settings.communityEndpointURL);this.addMetaTag("salesforce-client-id",this.settings.loginClientId);this.addMetaTag("salesforce-redirect-uri",this.settings.loginRedirectURL);this.addMetaTag("salesforce-mode","popup");this.addMetaTag("salesforce-target",this.settings.loginTargetQuerySelector);this.addMetaTag("salesforce-login-handler",B);this.addMetaTag("salesforce-logout-handler",v);this.addEventHandler("requireauth",function(){var ar=setInterval(function(){if(window.SFIDWidget){clearInterval(ar);if(window.SFIDWidget.openid_response){window[B]();}else{window.SFIDWidget.login();}}},L);});this.addEventHandler("autherror",function(at){var ar;if(window.SFIDWidget){this.loginButtonPressed=true;window.SFIDWidget.logout();ar=setInterval(function(){if(window.SFIDWidget.config){clearInterval(ar);this.fireEvent("requireauth");}}.bind(this,ar),L);}}.bind(this));window[B]=function(){var at=document.querySelector(this.settings.loginTargetQuerySelector);var ar=document.createElement("button");if(this.loginButtonPressed||this.componentInitInProgress){at.innerHTML="";}ar.className="authenticationStart";ar.innerHTML=this.settings.authenticationStartLabel;ar.addEventListener("click",this.onHelpButtonClick.bind(this));at.appendChild(ar);this.auth.oauthToken=window.SFIDWidget.openid_response.access_token;}.bind(this);window[v]=function(){this.auth.oauthToken=undefined;window.SFIDWidget.init();}.bind(this);document.head.appendChild(aq);aq.sheet.insertRule(".sfid-logout { display: none; }",0);ao.type="text/javascript";ao.src=this.settings.communityEndpointURL+"/servlet/servlet.loginwidgetcontroller?type=javascript_widget"+(embedded_svc.settings.devMode?"&min=false":"");document.head.appendChild(ao);}};l.prototype.validateHeaderValue=function D(ao){return/^[0-9a-zA-Z!#$%&'*+-.^_`|~" ]*$/g.test(ao);};window.embedded_svc=new l();Object.getOwnPropertyNames(w).forEach(function(ao){var ap=w[ao];if(ap==="object"){window.embedded_svc[ao]={};Object.keys(ap).forEach(function(aq){window.embedded_svc[ao][aq]=ap[aq];});}else{window.embedded_svc[ao]=ap;}}); alert('script Loaded'); })(window.embedded_svc||{});